(this.webpackJsonpreact=this.webpackJsonpreact||[]).push([[0],{18:function(e,n,t){},20:function(e,n,t){"use strict";t.r(n);var r=t(1),c=t(8),i=t(9),a=t(4),o=t(3),s=t(5),l=(t(18),t(2)),f=t(0),m=["size","variant"];var u={performances:[{name:"performance 1",id:"a",tempo:72,notes:"notes 1"},{name:"performance 2",id:"b",tempo:72,notes:"notes 2"},{name:"performance 3",id:"c",tempo:72,notes:"notes 3"}],selectedPerformanceId:"c",performanceActive:!1,showSetTempo:!1,exportViewVisible:!1,importViewVisible:!1,mainPanelView:"performancesList",editingPerformance:!1};function j(e){return localStorage.setItem("app.performances",JSON.stringify(e)),e}var d=function(){var e=localStorage.getItem("app.performances");return null!=e?JSON.parse(e):u}();function p(e,n){switch(n.type){case"add":return j(Object(l.a)(e,(function(e){e.performances.push(n.performance)})));case"delete":return j(Object(l.a)(e,(function(e){e.performances=e.performances.filter((function(e){return e.id!==n.performanceId})),e.selectedPerformanceId===n.performanceId&&(e.selectedPerformanceId=null,e.performanceActive=!1)})));case"deleteAll":return j(Object(l.a)(e,(function(e){e.performances=[],e.selectedPerformanceId=null,e.performanceActive=!1})));case"setPerformanceName":return j(Object(l.a)(e,(function(e){e.performances.filter((function(e){return e.id===n.performanceId}))[0].name=n.name})));case"move":return j(Object(l.a)(e,(function(e){var t,r=0,c=Object(s.a)(e.performances);try{for(c.s();!(t=c.n()).done;){if(t.value.id===n.performanceId)break;r++}}catch(a){c.e(a)}finally{c.f()}var i=r+n.increment;if(-1!==i&&i<e.performances.length)try{!function(e,n,t){var r=e.splice(n,1)[0];e.splice(t,0,r)}(e.performances,r,i)}catch(o){console.error("error moving item from "+r+" to "+i,o)}})));case"open":return Object(l.a)(e,(function(e){e.selectedPerformanceId=n.performanceId,e.performanceActive=!1,e.mainPanelView="performance"}));case"close":return Object(l.a)(e,(function(e){e.selectedPerformanceId=null,e.performanceActive=!1}));case"previous":return Object(l.a)(e,(function(e){var t,r=0,c=Object(s.a)(e.performances);try{for(c.s();!(t=c.n()).done;){if(t.value.id===n.performanceId)break;r++}}catch(a){c.e(a)}finally{c.f()}var i=r-1;r<=0&&(i=0===e.performances.length?null:e.performances.length-1),e.selectedPerformanceId=null==i?null:e.performances[i].id,e.performanceActive=!1,e.editingPerformance=!1}));case"next":return Object(l.a)(e,(function(e){var t,r=0,c=Object(s.a)(e.performances);try{for(c.s();!(t=c.n()).done;){if(t.value.id===n.performanceId)break;r++}}catch(a){c.e(a)}finally{c.f()}var i=r+1;r>=e.performances.length-1&&(i=0===e.performances.length?null:0),e.selectedPerformanceId=null==i?null:e.performances[i].id,e.performanceActive=!1,e.editingPerformance=!1}));case"start":return Object(l.a)(e,(function(e){e.performanceActive=!0}));case"stop":return Object(l.a)(e,(function(e){e.performanceActive=!1}));case"incrementTempo":return j(Object(l.a)(e,(function(e){e.performances.filter((function(e){return e.id===n.performanceId}))[0].tempo+=Number(n.increment)})));case"setTempo":return j(Object(l.a)(e,(function(e){var t=e.performances.filter((function(e){return e.id===n.performanceId}))[0];n.tempo>300?t.tempo=42:t.tempo=Math.round(Number(n.tempo))})));case"showSetTempo":return Object(l.a)(e,(function(e){e.showSetTempo=!0}));case"hideSetTempo":return Object(l.a)(e,(function(e){e.showSetTempo=!1}));case"setNotes":return j(Object(l.a)(e,(function(e){e.performances.filter((function(e){return e.id===n.performanceId}))[0].notes=n.notes})));case"toggleImportView":return Object(l.a)(e,(function(e){e.importViewVisible=n.importViewVisible,e.exportViewVisible=!1}));case"toggleExportView":return Object(l.a)(e,(function(e){e.exportViewVisible=n.exportViewVisible,e.importViewVisible=!1}));case"toggleAppMainPanelView":return Object(l.a)(e,(function(e){e.mainPanelView=n.appMainPanelView,e.editingPerformance=!1,e.performanceActive=!1}));case"import":return j(Object(l.a)(e,(function(e){e.performances=n.performances})));case"toggleEditingPerformance":return Object(l.a)(e,(function(e){e.editingPerformance=n.editingPerformance}));default:return e}}var b=Object(r.createContext)(),O=Object(r.createContext)();function v(){return Object(r.useContext)(b)}function x(){return Object(r.useContext)(O)}function h(){var e,n=v(),t=Object(s.a)(n.performances);try{for(t.s();!(e=t.n()).done;){var r=e.value;if(r.id===n.selectedPerformanceId)return r}}catch(c){t.e(c)}finally{t.f()}return null}function g(e){var n=e.children,t=Object(r.useReducer)(p,d),c=Object(o.a)(t,2),i=c[0],a=c[1];return Object(f.jsx)(b.Provider,{value:i,children:Object(f.jsx)(O.Provider,{value:a,children:n})})}function y(e){var n="btn";return n+=" btn-"+(null!=e.variant?e.variant:"light"),Object(f.jsx)("button",Object(a.a)(Object(a.a)({className:n},e),{},{children:e.children}))}var w=Object(r.forwardRef)((function(e,n){return Object(f.jsx)("input",Object(a.a)({ref:n,className:"form-control"},e))})),N=Object(r.forwardRef)((function(e,n){var t=Object(r.useRef)();null==n&&(n=t),Object(r.useEffect)((function(){n.current.style.height=0,n.current.style.height=n.current.scrollHeight+"px",n.current.style.overflowY=null!=e.maxHeight?"scroll":"hidden",n.current.style.maxHeight=null!=e.maxHeight?e.maxHeight+"rem":null}),[n,e.value,e.maxHeight]);var c=Object(r.useCallback)((function(){n.current.style.height=0,n.current.style.height=n.current.scrollHeight+"px"}),[n]);return Object(f.jsx)("textarea",Object(a.a)({ref:n,onInput:c,className:"form-control"},e))}));function C(){return Object(f.jsx)("div",{className:"App",children:Object(f.jsx)(g,{children:Object(f.jsx)(P,{})})})}function P(){return Object(f.jsxs)("div",{className:"mb-5",children:[Object(f.jsx)(k,{}),Object(f.jsx)(V,{})]})}function k(){var e=x(),n=v();return Object(f.jsxs)("div",{className:"p-2 pt-3 bg-light",children:[Object(f.jsx)(y,{variant:"link",style:{fontWeight:"performancesList"===n.mainPanelView?"bold":"initial"},onClick:function(){e({type:"toggleAppMainPanelView",appMainPanelView:"performancesList"})},children:"Performance List"}),Object(f.jsx)(y,{variant:"link",style:{fontWeight:"performance"===n.mainPanelView?"bold":"initial"},onClick:function(){e({type:"toggleAppMainPanelView",appMainPanelView:"performance"})},children:"Performance"})]})}function V(){var e=v();return Object(f.jsxs)("div",{children:["performancesList"===e.mainPanelView&&Object(f.jsx)(S,{}),"performance"===e.mainPanelView&&Object(f.jsx)(R,{})]})}function I(){v();var e=x(),n=Object(r.useState)(!0),t=Object(o.a)(n,2),c=t[0];t[1];return Object(f.jsx)("div",{className:"d-flex justify-content-end gap-2 my-3 mx-2",children:c&&Object(f.jsxs)("div",{className:"d-flex justify-content-center gap-2",children:[Object(f.jsx)(y,{onClick:function(){e({type:"toggleExportView",exportViewVisible:!0})},children:"Export"}),Object(f.jsx)(y,{onClick:function(){e({type:"toggleImportView",importViewVisible:!0})},children:"Import"}),Object(f.jsx)(y,{onClick:function(){window.confirm("Are you sure you want to delete all performances?")&&e({type:"deleteAll"})},children:"Delete All"})]})})}function S(){var e=v(),n=e.performances.map((function(e){return Object(f.jsx)(E,{performance:e},e.id)}));return Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{className:"m-2",children:Object(f.jsx)(I,{})}),e.exportViewVisible&&Object(f.jsx)("div",{className:"mb-3",children:Object(f.jsx)(_,{})}),e.importViewVisible&&Object(f.jsx)("div",{className:"mb-3",children:Object(f.jsx)(ee,{})}),Object(f.jsx)("div",{className:"m-3",children:Object(f.jsx)(M,{})}),Object(f.jsx)("ul",{className:"list-group",children:n})]})}function E(e){var n=e.performance,t=Object(r.useState)(!1),c=Object(o.a)(t,2),i=c[0],a=c[1];return i?Object(f.jsx)(T,{performance:n,setEditing:a}):Object(f.jsx)(A,{performance:n,setEditing:a})}function A(e){var n=e.performance,t=e.setEditing,r=x();return Object(f.jsx)("li",{class:"list-group-item list-group-item-action",style:{cursor:"pointer"},children:Object(f.jsxs)("div",{className:"d-flex align-items-baseline gap-2",onClick:function(){r({type:"open",performanceId:n.id})},children:[Object(f.jsx)("span",{className:"flex-grow-1",children:n.name}),Object(f.jsx)(y,{onClick:function(e){t(!0),e.stopPropagation()},children:"Edit"})]})})}function T(e){var n=e.performance,t=e.setEditing,c=Object(r.useState)(n.name),i=Object(o.a)(c,2),a=i[0],s=i[1],l=x(),m=Object(r.useRef)();Object(r.useEffect)((function(){m.current.select(),m.current.focus()}),[]);var u=function(){l({type:"setPerformanceName",performanceId:n.id,name:a}),t(!1)},j=Object(r.useCallback)((function(e){"Enter"===e.key&&u()}),[u]);return Object(f.jsx)("li",{class:"list-group-item",children:Object(f.jsxs)("div",{className:"",children:[Object(f.jsx)("div",{children:Object(f.jsx)(w,{value:a,ref:m,placeholder:"performance name",onChange:function(e){return s(e.target.value)},onKeyDown:j})}),Object(f.jsxs)("div",{className:"d-flex justify-content-end gap-2 mt-2 mb-2",children:[Object(f.jsx)(y,{onClick:function(){l({type:"move",performanceId:n.id,increment:-1})},children:"Move Up"}),Object(f.jsx)(y,{onClick:function(){l({type:"move",performanceId:n.id,increment:1})},children:"Move Down"}),Object(f.jsx)(y,{onClick:function(){window.confirm("Are you sure you want to delete this performance?")&&l({type:"delete",performanceId:n.id})},children:"Delete"}),Object(f.jsx)(y,{onClick:function(e){return t(!1)},children:"Cancel"}),Object(f.jsx)(y,{variant:"primary",onClick:u,children:"Save"})]})]})})}function M(){var e=x(),n=Object(r.useState)(""),t=Object(o.a)(n,2),c=t[0],i=t[1],a=""===c.trim(),s=Object(r.useCallback)((function(){e({type:"add",performance:{name:c,id:(new Date).toISOString(),tempo:42,notes:""}}),i("")}),[e,c,i]),l=Object(r.useCallback)((function(e){"Enter"===e.key&&s()}),[s]);return Object(f.jsxs)("div",{className:"d-flex gap-2",children:[Object(f.jsx)(w,{value:c,placeholder:"",onChange:function(e){return i(e.target.value)},onKeyDown:l}),Object(f.jsx)(y,{variant:"primary",disabled:a,onClick:s,children:"Add"})]})}function R(){var e=h();return Object(f.jsx)("div",{children:null==e?Object(f.jsx)("div",{children:"No performance selected"}):Object(f.jsx)(D,{performance:e})})}var H=Object(r.forwardRef)((function(e,n){var t=e.size,r=void 0===t?1:t,c=e.variant,o=void 0===c?"primary":c,s=Object(i.a)(e,m),l={height:r+"rem",width:r+"rem",borderRadius:"50%",backgroundColor:"var(--bs-".concat(o,")"),transition:"opacity 0.1s, background-color 0.1s, background 0.1s",cursor:null!=s.onClick?"pointer":null,display:"flex",alignItems:"center",justifyContent:"center"};return Object(f.jsx)("div",Object(a.a)({ref:n,className:"dot",style:l},s))}));function D(e){var n=e.performance,t=function(e){var n=Object(r.useState)(e.name),t=Object(o.a)(n,2),c=t[0],i=t[1],a=Object(r.useState)(e.notes),s=Object(o.a)(a,2),l=s[0],f=s[1],m=v(),u=x();return Object(r.useEffect)((function(){i(e.name),f(e.notes)}),[e.name,e.notes,m.editingPerformance]),{name:c,setName:i,notes:l,setNotes:f,save:function(){u({type:"setNotes",performanceId:e.id,notes:l}),u({type:"setPerformanceName",performanceId:e.id,name:c})}}}(n);return Object(f.jsxs)("div",{children:[Object(f.jsx)(J,{performance:n}),Object(f.jsx)(K,Object(a.a)({performance:n},t)),Object(f.jsx)(U,Object(a.a)({performance:n},t)),Object(f.jsx)(F,Object(a.a)({},t)),Object(f.jsx)(Y,{performance:n})]})}function J(e){var n=e.performance,t=v(),r=function(e,n){for(var t=0;t<e.length;t++)if(e[t].id===n)return t;return null}(t.performances,n.id)+1,c=t.performances.length;return Object(f.jsxs)("div",{className:"d-flex m-3 align-items-baseline",style:{justifyContent:"space-between"},children:[Object(f.jsx)(L,{}),Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{className:"lead",children:n.name}),Object(f.jsx)("div",{children:Object(f.jsxs)("small",{className:"text-muted",children:[r,"/",c]})})]}),Object(f.jsx)(z,{})]})}function L(){var e=x(),n=v(),t=1===n.performances.length;return Object(f.jsx)(y,{disabled:t,onClick:function(){e({type:"previous",performanceId:n.selectedPerformanceId})},children:"Previous"})}function z(){var e=x(),n=v(),t=1===n.performances.length;return Object(f.jsx)(y,{disabled:t,onClick:function(){e({type:"next",performanceId:n.selectedPerformanceId})},children:"Next"})}function K(e){e.performance;var n=e.name,t=e.setName;return v().editingPerformance?Object(f.jsx)("div",{className:"m-3",children:Object(f.jsx)(w,{value:n,placeholder:"name",onChange:function(e){return t(e.target.value)}})}):null}function U(e){var n=e.performance,t=e.notes,r=e.setNotes;return v().editingPerformance?Object(f.jsx)(B,{performance:n,notes:t,setNotes:r}):Object(f.jsx)(W,{performance:n})}function W(e){var n=e.performance;e.setEditing;return Object(f.jsx)("div",{className:"d-flex gap-2 align-items-end m-3",children:Object(f.jsx)("div",{className:"flex-grow-1",children:Object(f.jsx)(N,{readOnly:!0,value:n.notes,placeholder:"(no notes)"})})})}function B(e){e.performance;var n=e.notes,t=e.setNotes;return Object(f.jsx)("div",{children:Object(f.jsx)("div",{className:"m-3",children:Object(f.jsx)(N,{value:n,placeholder:"notes",onChange:function(e){return t(e.target.value)}})})})}function F(e){var n=e.save,t=v(),r=x();return t.editingPerformance?Object(f.jsxs)("div",{className:"d-flex justify-content-end gap-2 m-3",children:[Object(f.jsx)(y,{onClick:function(){r({type:"toggleEditingPerformance",editingPerformance:!1})},children:"Cancel"}),Object(f.jsx)(y,{variant:"primary",onClick:function(){n(),r({type:"toggleEditingPerformance",editingPerformance:!1})},children:"Save"})]}):Object(f.jsx)("div",{className:"d-flex justify-content-end gap-2 m-3",children:Object(f.jsx)(y,{onClick:function(){r({type:"toggleEditingPerformance",editingPerformance:!0})},children:"Edit"})})}function Y(e){var n=e.performance,t=v();return Object(f.jsxs)("div",{children:[Object(f.jsxs)("div",{className:"lead",children:["Tempo ",n.tempo]}),Object(f.jsx)("div",{children:t.performanceActive?Object(f.jsx)(Z,{performance:n}):Object(f.jsx)($,{performance:n})}),Object(f.jsx)("div",{className:"mt-4",children:Object(f.jsx)(G,{performance:n})})]})}function q(e){var n=e.performance,t=x();return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(y,{onClick:function(){t({type:"incrementTempo",performanceId:n.id,increment:-1})},children:"Down"}),Object(f.jsx)(y,{onClick:function(){t({type:"incrementTempo",performanceId:n.id,increment:1})},children:"Up"})]})}function G(e){var n=e.performance,t=x(),r=function(e){t({type:"setTempo",performanceId:n.id,tempo:e})};return Object(f.jsxs)("div",{className:"d-flex justify-content-center gap-2 m-3",children:[Object(f.jsx)(X,{tempo:n.tempo,setTempo:r}),Object(f.jsx)(Q,{performance:n,tempo:n.tempo,setTempo:r}),Object(f.jsx)(q,{performance:n})]})}function Q(e){e.performance;var n=e.tempo,t=e.setTempo;return Object(f.jsx)("span",{children:Object(f.jsx)(w,{type:"number",onChange:function(e){return t(e.target.value)},value:n,style:{width:"6rem"}})})}function X(e){var n=e.setTempo,t=[];return Object(f.jsx)(y,{onClick:function(){console.log("tap tempo"),function(){t.push(new Date-0),t.length>5&&(t=t.slice(1));var e,r=t.map((function(e,n){return 0===n?0:e-t[n-1]})),c=r.slice(1).reduce((function(e,n){return e+n}),0)/(r.length-1),i=Math.round((e=c)<=0?42:6e4/e);console.log("tempo bpm "+i,c,t),null==n||isNaN(i)||n(i)}()},children:"Tap"})}function Z(e){var n=e.performance,t=x(),c=Object(r.useRef)(),i=function(){try{null!=c.current&&(c.current.style.backgroundColor="var(--bs-primary)")}catch(e){console.error("error in tick",e)}setTimeout((function(){try{null!=c.current&&(c.current.style.backgroundColor="var(--bs-light)")}catch(e){console.error("error in tick",e)}}),75)};return Object(r.useEffect)((function(){if(i(),n.tempo>0){var e=setInterval((function(){i()}),(t=n.tempo)<=0?42:6e4/t);return function(){clearInterval(e)}}var t}),[n.tempo]),Object(f.jsx)("div",{children:Object(f.jsx)("div",{className:"d-flex justify-content-center m-2",children:Object(f.jsx)(H,{ref:c,size:8,variant:"light",onClick:function(){t({type:"stop"})}})})})}function $(e){e.performance;var n=x();return Object(f.jsx)("div",{className:"d-flex justify-content-center m-2",children:Object(f.jsx)(H,{size:8,variant:"light",onClick:function(){n({type:"start"})},children:Object(f.jsx)("div",{children:"Start"})})})}function _(){var e=Object(r.useRef)(),n=v(),t=x(),c=JSON.stringify(n.performances),i=Object(r.useState)(!1),a=Object(o.a)(i,2),s=a[0],l=a[1];Object(r.useEffect)((function(){if(s){var e=window.setTimeout((function(){l(!1)}),3e3);return function(){window.clearTimeout(e)}}}),[s]);return Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{className:"m-3",children:Object(f.jsx)(N,{readOnly:!0,ref:e,value:c,maxHeight:10,children:"{json}"})}),Object(f.jsxs)("div",{className:"d-flex justify-content-center gap-2",children:[Object(f.jsx)(y,{onClick:function(){t({type:"toggleExportView",exportViewVisible:!1})},children:"Close"}),Object(f.jsx)(y,{variant:"primary",onClick:function(){console.log("Export json",e.current.value),e.current.select(),e.current.setSelectionRange(0,99999),document.execCommand("copy"),l(!0)},children:s?"Copied!":"Copy"})]})]})}function ee(){var e=x(),n=Object(r.useState)('[{"name":"performance 1","id":"a","tempo":72,"notes":"notes 1"}]'),t=Object(o.a)(n,2),c=t[0],i=t[1];return Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{className:"m-3",children:Object(f.jsx)(N,{value:c,onChange:function(e){return i(e.target.value)},maxHeight:10})}),Object(f.jsxs)("div",{className:"d-flex justify-content-center gap-2",children:[Object(f.jsx)(y,{onClick:function(){e({type:"toggleImportView",importViewVisible:!1})},children:"Close"}),Object(f.jsx)(y,{variant:"primary",onClick:function(){try{var n=JSON.parse(c);e({type:"import",performances:n})}catch(t){console.error("Error parsing JSON",t),window.alert("Error parsing JSON: "+t)}},children:"Import"})]})]})}var ne=document.getElementById("root");Object(c.createRoot)(ne).render(Object(f.jsx)(r.StrictMode,{children:Object(f.jsx)(C,{})}))}},[[20,1,2]]]);
//# sourceMappingURL=main.bd0df762.chunk.js.map